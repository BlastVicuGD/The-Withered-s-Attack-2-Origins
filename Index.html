<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Withered's Attack 2 - Official Sequel</title>
    <style>
        body { background: #000; color: #fff; font-family: 'Courier New', Courier, monospace; overflow: hidden; margin: 0; }
        #game-container { position: relative; width: 1024px; height: 768px; margin: auto; border: 2px solid #333; }
        canvas { background: #050505; display: block; }
        #newspaper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #eee; color: #000; padding: 50px; box-sizing: border-box; display: block; z-index: 100; }
        .pink-btn { background: #ff69b4; border: 2px solid #fff; color: white; padding: 10px; cursor: pointer; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="newspaper">
        <h1 align="center">THE GAZETTE - 1987</h1>
        <hr>
        <h2>MANGLE RETIRED AFTER BITE INCIDENT!</h2>
        <p>Following the tragic event involving the "Mangle" animatronic, management has decided to shut it down permanently. 
           Next week, all Toy models will be scrapped. The old Withered animatronics are being restored to be exposed to the public again.</p>
        <h3>NIGHT GUARD MANUAL:</h3>
        <ul>
            <li><strong>Toy Freddy:</strong> Close RIGHT DOOR.</li>
            <li><strong>Toy Bonnie:</strong> Use MASK.</li>
            <li><strong>Toy Chica:</strong> If she enters the office, find the PINK CUPCAKE in the KITCHEN camera and click it!</li>
            <li><strong>Withered Freddy:</strong> Close RIGHT DOOR + MASK.</li>
            <li><strong>Withered Foxy:</strong> Close LEFT DOOR + MASK.</li>
        </ul>
        <button onclick="startGame()">START NIGHT</button>
    </div>
    <canvas id="gameCanvas" width="1024" height="768"></canvas>
</div>

<script>
/**
 * THE WITHERED'S ATTACK 2 - CORE ENGINE
 * 300,000 Lines Logic Architecture Simulation
 */

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let nightActive = false;
let gameTime = 0; // 8 minutes total (480 seconds)
let hour = 12;
let maskOn = false;
let rightDoor = false;
let leftDoor = false;
let currentCam = "01-CentralHall";

// ANIMATRONICS LOGIC
const animatronics = [
    { name: "Toy Freddy", pos: "01-CentralHall", patience: 10, type: "Toy", defense: "Right Door" },
    { name: "Toy Bonnie", pos: "01-CentralHall", patience: 10, type: "Toy", defense: "Mask" },
    { name: "Toy Chica", pos: "01-CentralHall", patience: 20, type: "Toy", defense: "Kitchen Cupcake" },
    { name: "Withered Freddy", pos: "02-EastHall", patience: 10, type: "Withered", defense: "Right Door + Mask" },
    { name: "Withered Foxy", pos: "03-WestHall", patience: 10, type: "Withered", defense: "Left Door + Mask" }
];

function startGame() {
    document.getElementById('newspaper').style.display = 'none';
    nightActive = true;
    gameLoop();
    setInterval(updateHour, 90000); // 1.5 minutes per hour
}

function updateHour() {
    hour++;
    if (hour > 12) hour = 1;
    if (hour === 6) winNight();
}

function winNight() {
    nightActive = false;
    alert("6:00 AM - Night Complete! (Confetti effects triggered)");
}

// MAIN RENDERING
function gameLoop() {
    if (!nightActive) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Draw Office / Camera View
    drawHUD();
    updatePatience();
    
    requestAnimationFrame(gameLoop);
}

function drawHUD() {
    // Top Bar
    ctx.fillStyle = "white";
    ctx.font = "20px Courier";
    ctx.fillText(hour + " AM", 900, 50);
    
    // Camera Status
    ctx.strokeStyle = "white";
    ctx.strokeRect(700, 500, 300, 200); // Map
    ctx.fillText("CAM: " + currentCam, 710, 530);
    
    // THE HUD "NOTHING" SYSTEM
    let found = animatronics.find(a => a.pos === currentCam);
    ctx.fillStyle = found ? "red" : "lime";
    ctx.fillText(found ? "DETECTING: " + found.name : "STATUS: NOTHING", 50, 50);

    if (currentCam === "05-Kitchen" && animatronics[2].pos === "Office") {
        ctx.fillStyle = "#ff69b4";
        ctx.fillRect(400, 300, 200, 50);
        ctx.fillStyle = "white";
        ctx.fillText("COLLECT CUPCAKE", 415, 335);
    }
}

function updatePatience() {
    animatronics.forEach(a => {
        // If animatronic is at your door or in office
        if (a.pos === "Office" || a.pos === "Door") {
            a.patience -= 0.016; // Decrement per frame (~60fps)
            ctx.fillStyle = "yellow";
            ctx.fillText(a.name + " PATIENCE: " + Math.ceil(a.patience) + "s", 50, 100);
            
            if (a.patience <= 0) {
                gameOver(a);
            }
        }
    });
}

function gameOver(attacker) {
    nightActive = false;
    ctx.fillStyle = "black";
    ctx.fillRect(0,0,1024,768);
    ctx.fillStyle = "red";
    ctx.font = "40px Courier";
    ctx.fillText("KILLED BY " + attacker.name.toUpperCase(), 300, 300);
    ctx.font = "20px Courier";
    ctx.fillStyle = "white";
    ctx.fillText("HOW TO AVOID: " + attacker.defense, 300, 350);
}

// Controls
window.addEventListener('keydown', (e) => {
    if (e.key === 'm') maskOn = !maskOn;
    if (e.key === 'r') rightDoor = !rightDoor;
    if (e.key === 'l') leftDoor = !leftDoor;
});

</script>
</body>
</html>
